# ç¬¬16ç«  å‰ç¼€å’Œ ğŸ“Š

å‰ç¼€å’Œæ˜¯ä¸€ç§é‡è¦çš„é¢„å¤„ç†æŠ€æœ¯ï¼Œé€šè¿‡é¢„è®¡ç®—ç´¯ç§¯å’Œæ¥å®ç°åŒºé—´æŸ¥è¯¢çš„O(1)æ—¶é—´å¤æ‚åº¦ã€‚å®ƒæ˜¯è§£å†³åŒºé—´å’ŒæŸ¥è¯¢ã€å­æ•°ç»„é—®é¢˜çš„æ ¸å¿ƒå·¥å…·ï¼Œåœ¨æ•°ç»„å¤„ç†å’Œç®—æ³•ä¼˜åŒ–ä¸­æœ‰ç€å¹¿æ³›åº”ç”¨ã€‚

## åŸºç¡€æ¦‚å¿µä»‹ç» ğŸ”§

### ä¸€ç»´å‰ç¼€å’Œ

1. **é¢„å¤„ç†**ï¼šæ„å»ºä¸€ä¸ªå‰ç¼€å’Œæ•°ç»„ `prefix`ï¼Œå…¶ä¸­ `prefix[i]` è¡¨ç¤ºåŸæ•°ç»„ `nums[0] + nums[1] + ... + nums[i-1]`ï¼ˆæˆ–æ ¹æ®å®šä¹‰å¯èƒ½åŒ…å« `nums[i]`ï¼Œéœ€æ˜ç¡®è¾¹ç•Œï¼‰ã€‚
2. **å¿«é€ŸæŸ¥è¯¢**ï¼šé€šè¿‡ `prefix[r+1] - prefix[l]` å¿«é€Ÿè®¡ç®—åŸæ•°ç»„åŒºé—´ `[l, r]` çš„å’Œã€‚

#### å®šä¹‰ä¸æ„å»º

```javascript
/**
 * ä¸€ç»´å‰ç¼€å’Œæ•°ç»„æ„å»º
 *
 * æ ¸å¿ƒæ€æƒ³ï¼š
 * prefixSum[i] = arr[0] + arr[1] + ... + arr[i-1]
 * prefixSum[0] = 0ï¼Œä¾¿äºå¤„ç†è¾¹ç•Œæƒ…å†µ
 *
 * @param {number[]} arr - åŸæ•°ç»„
 * @returns {number[]} å‰ç¼€å’Œæ•°ç»„
 */
function buildPrefixSum(nums) {
    const n = nums.length;
    const prefix = new Array(n + 1).fill(0); // prefix[0] = 0
    for (let i = 1; i <= n; i++) {
        prefix[i] = prefix[i - 1] + nums[i - 1]; // numsä»0å¼€å§‹ï¼Œprefixä»1å¼€å§‹
    }
    return prefix;
}

// ç¤ºä¾‹
const arr = [1, 2, 3, 4, 5];
const prefixSum = buildPrefixSum(arr);
console.log(prefixSum); // [0, 1, 3, 6, 10, 15]
```

#### åŒºé—´å’ŒæŸ¥è¯¢

```javascript
/**
 * æŸ¥è¯¢åŒºé—´[left, right]çš„å’Œï¼ˆåŒ…å«ä¸¤ç«¯ï¼‰
 *
 * æ ¸å¿ƒå…¬å¼ï¼š
 * sum(left, right) = prefixSum[right + 1] - prefixSum[left]
 *
 * @param {number[]} prefixSum - å‰ç¼€å’Œæ•°ç»„
 * @param {number} left - å·¦ç«¯ç‚¹ç´¢å¼•
 * @param {number} right - å³ç«¯ç‚¹ç´¢å¼•
 * @returns {number} åŒºé—´å’Œ
 */
function rangeSum(prefixSum, left, right) {
    return prefixSum[right + 1] - prefixSum[left];
}

// ç¤ºä¾‹ï¼šæŸ¥è¯¢arr[1..3]çš„å’Œ
console.log(rangeSum(prefixSum, 1, 3)); // 2 + 3 + 4 = 9
```

### äºŒç»´å‰ç¼€å’Œ

#### é€’æ¨å…¬å¼æ¨å¯¼è¿‡ç¨‹ ğŸ“

**æ ¸å¿ƒå®šä¹‰**ï¼š`prefixSum[i][j]` è¡¨ç¤ºä»çŸ©é˜µå·¦ä¸Šè§’ `(0,0)` åˆ°ä½ç½® `(i-1,j-1)` çš„çŸ©å½¢åŒºåŸŸå†…æ‰€æœ‰å…ƒç´ çš„å’Œã€‚

**æ¨å¯¼æ€è·¯**ï¼šè¦è®¡ç®— `prefixSum[i][j]`ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å·²ç»è®¡ç®—å¥½çš„ç›¸é‚»åŒºåŸŸçš„å‰ç¼€å’Œã€‚

```
é€’æ¨å…¬å¼ï¼š
prefixSum[i][j] = prefixSum[i-1][j]
                + prefixSum[i][j-1]
                - prefixSum[i-1][j-1] + matrix[i-1][j-1]
```

#### å›¾å½¢åŒ–æ¨å¯¼è¿‡ç¨‹ ğŸ¨

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªçŸ©é˜µï¼Œè¦è®¡ç®—åˆ°ä½ç½® `(i,j)` çš„å‰ç¼€å’Œï¼š

```
åŸå§‹çŸ©é˜µ matrix:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  1  â”‚  2  â”‚  3  â”‚  4  â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  5  â”‚  6  â”‚  7  â”‚  8  â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  9  â”‚ 10  â”‚ 11  â”‚ 12  â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ 13  â”‚ 14  â”‚ 15  â”‚ 16  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

**æ­¥éª¤1ï¼šç†è§£é—®é¢˜**
æˆ‘ä»¬è¦è®¡ç®— `prefixSum[2][2]`ï¼ˆå³ä»(0,0)åˆ°(1,1)çš„åŒºåŸŸå’Œï¼‰

```
ç›®æ ‡åŒºåŸŸï¼ˆæˆ‘ä»¬è¦è®¡ç®—çš„åŒºåŸŸï¼‰:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  1  â”‚  2  â”‚ â† è¿™ä¸ªåŒºåŸŸçš„å’Œ
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚  5  â”‚  6  â”‚ â† å°±æ˜¯ 1+2+5+6 = 14
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

**æ­¥éª¤2ï¼šåˆ†è§£å­é—®é¢˜**
æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸‰ä¸ªå·²çŸ¥çš„å­åŒºåŸŸï¼š

```
prefixSum[1][2] (ä¸Šæ–¹åŒºåŸŸ):
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  1  â”‚  2  â”‚ = 3
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜

prefixSum[2][1] (å·¦æ–¹åŒºåŸŸ):
â”Œâ”€â”€â”€â”€â”€â”
â”‚  1  â”‚ = 1
â”œâ”€â”€â”€â”€â”€â”¤
â”‚  5  â”‚ = 5
â””â”€â”€â”€â”€â”€â”˜
æ€»å’Œ = 6

prefixSum[1][1] (å·¦ä¸Šé‡å åŒºåŸŸ):
â”Œâ”€â”€â”€â”€â”€â”
â”‚  1  â”‚ = 1
â””â”€â”€â”€â”€â”€â”˜
```

**æ­¥éª¤3ï¼šå®¹æ–¥åŸç†åº”ç”¨**

```
ç›´æ¥ç›¸åŠ ä¼šé‡å¤è®¡ç®—é‡å åŒºåŸŸï¼š

  prefixSum[1][2]     +     prefixSum[2][1]
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”
â”‚  1  â”‚  2  â”‚     +     â”‚  1  â”‚ â† è¿™ä¸ª1è¢«è®¡ç®—äº†ä¸¤æ¬¡ï¼
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”¤
â”‚     â”‚     â”‚           â”‚  5  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”˜
     = 3                   = 6
```

**æ­¥éª¤4ï¼šå‡å»é‡å éƒ¨åˆ†**

```
prefixSum[1][2] + prefixSum[2][1] - prefixSum[1][1] + matrix[1][1]
      3         +         6        -         1        +     6     = 14

è§£é‡Šï¼š
- prefixSum[1][2] = 3 (åŒºåŸŸ1+2)
- prefixSum[2][1] = 6 (åŒºåŸŸ1+5)
- prefixSum[1][1] = 1 (é‡å çš„åŒºåŸŸ1ï¼Œéœ€è¦å‡å»)
- matrix[1][1] = 6 (å½“å‰ä½ç½®çš„å€¼ï¼Œéœ€è¦åŠ ä¸Š)
```

#### å®Œæ•´å›¾è§£ç¤ºä¾‹ ğŸ–¼ï¸

è®©æˆ‘ä»¬ç”¨å…·ä½“æ•°å€¼æ¼”ç¤ºæ•´ä¸ªè¿‡ç¨‹ï¼š

```
åŸçŸ©é˜µ:
     j=0  j=1  j=2
i=0   1    2    3
i=1   4    5    6

æ„å»ºå‰ç¼€å’ŒçŸ©é˜µ prefixSumï¼ˆå¤§å°ä¸º (m+1)Ã—(n+1)ï¼ŒåŒ…å«å“¨å…µï¼‰:
        j=0  j=1  j=2  j=3
   i=0   0    0    0    0     â† å“¨å…µè¡Œ
   i=1   0    1    3    6     â† prefixSum[1][1]=1, prefixSum[1][2]=3, prefixSum[1][3]=6
   i=2   0    5   12   21     â† prefixSum[2][1]=5, prefixSum[2][2]=12, prefixSum[2][3]=21
```

**è®¡ç®— prefixSum[2][2] = 12 çš„è¿‡ç¨‹ï¼š**

```
æ­¥éª¤åˆ†è§£ï¼š
1. prefixSum[1][2] = 3    (ä¸Šæ–¹åŒºåŸŸ: 1+2)
2. prefixSum[2][1] = 5    (å·¦æ–¹åŒºåŸŸ: 1+4)
3. prefixSum[1][1] = 1    (é‡å åŒºåŸŸ: 1)
4. matrix[1][1] = 5       (å½“å‰ä½ç½®å€¼)

è®¡ç®—ï¼š3 + 5 - 1 + 5 = 12

éªŒè¯ï¼šå®é™…åŒºåŸŸå’Œ = 1+2+4+5 = 12 âœ…
```

#### é€’æ¨å…¬å¼çš„æ•°å­¦æœ¬è´¨ ğŸ§®

```
prefixSum[i][j] è¡¨ç¤ºè¿™ä¸ªçŸ©å½¢åŒºåŸŸçš„å’Œï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€ ... â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚(0,0)â”‚     â”‚     â”‚         â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€ ... â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚     â”‚     â”‚     â”‚         â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€ ... â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚     â”‚     â”‚     â”‚         â”‚     â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€ ... â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚     â”‚     â”‚     â”‚         â”‚(i-1,â”‚
â”‚     â”‚     â”‚     â”‚         â”‚j-1) â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€ ... â”€â”€â”´â”€â”€â”€â”€â”€â”˜

é€’æ¨åˆ†è§£ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”
â”‚prefixSum    â”‚+ â”‚     â”‚  -  â”‚é‡å  â”‚  +   â”‚å½“å‰ â”‚
â”‚[i-1][j]     â”‚  â”‚prefixâ”‚     â”‚åŒºåŸŸ â”‚      â”‚å…ƒç´  â”‚
â”‚             â”‚  â”‚Sum   â”‚     â”‚[i-1]â”‚      â”‚     â”‚
â”‚             â”‚  â”‚[i][j-â”‚     â”‚[j-1]â”‚      â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚1]   â”‚     â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜
                 â””â”€â”€â”€â”€â”€â”˜
```

#### çŸ©é˜µå‰ç¼€å’Œæ„å»º

```javascript
/**
 * äºŒç»´å‰ç¼€å’ŒçŸ©é˜µæ„å»º
 *
 * æ ¸å¿ƒæ€æƒ³ï¼š
 * prefixSum[i][j] = ä»(0,0)åˆ°(i-1,j-1)çš„çŸ©å½¢åŒºåŸŸå’Œ
 *
 * é€’æ¨å…¬å¼è¯¦è§£ï¼š
 * prefixSum[i][j] = prefixSum[i-1][j]    // ä¸Šæ–¹çŸ©å½¢åŒºåŸŸ
 *                 + prefixSum[i][j-1]    // å·¦æ–¹çŸ©å½¢åŒºåŸŸ
 *                 - prefixSum[i-1][j-1]  // å‡å»é‡å çš„å·¦ä¸Šè§’åŒºåŸŸï¼ˆè¢«ç®—äº†ä¸¤æ¬¡ï¼‰
 *                 + matrix[i-1][j-1]     // åŠ ä¸Šå½“å‰ä½ç½®çš„å…ƒç´ å€¼
 *
 * ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼š
 * 1. prefixSum[i-1][j] åŒ…å«äº†ä¸Šæ–¹æ‰€æœ‰åŒºåŸŸ
 * 2. prefixSum[i][j-1] åŒ…å«äº†å·¦æ–¹æ‰€æœ‰åŒºåŸŸ
 * 3. ä¸¤è€…ç›¸åŠ æ—¶ï¼Œå·¦ä¸Šè§’åŒºåŸŸè¢«é‡å¤è®¡ç®—ï¼Œéœ€è¦å‡å»
 * 4. æœ€ååŠ ä¸Šå½“å‰ä½ç½®çš„å€¼å®Œæˆè®¡ç®—
 *
 * @param {number[][]} matrix - åŸçŸ©é˜µ
 * @returns {number[][]} äºŒç»´å‰ç¼€å’ŒçŸ©é˜µ
 */
function build2DPrefixSum(matrix) {
    if (!matrix || matrix.length === 0) return [];

    const m = matrix.length;
    const n = matrix[0].length;
    // åˆ›å»º (m+1)Ã—(n+1) çš„å‰ç¼€å’ŒçŸ©é˜µï¼Œç¬¬0è¡Œå’Œç¬¬0åˆ—ä½œä¸ºå“¨å…µ
    const prefixSum = Array.from({length: m + 1}, () => new Array(n + 1).fill(0));

    console.log("å¼€å§‹æ„å»ºäºŒç»´å‰ç¼€å’Œ...");
    console.log("åŸçŸ©é˜µ:");
    matrix.forEach((row, i) => {
        console.log(`ç¬¬${i}è¡Œ: [${row.join(', ')}]`);
    });

    for (let i = 1; i <= m; i++) {
        for (let j = 1; j <= n; j++) {
            // åº”ç”¨é€’æ¨å…¬å¼
            const upperArea = prefixSum[i-1][j];      // ä¸Šæ–¹åŒºåŸŸ
            const leftArea = prefixSum[i][j-1];       // å·¦æ–¹åŒºåŸŸ
            const overlapArea = prefixSum[i-1][j-1];  // é‡å åŒºåŸŸ
            const currentValue = matrix[i-1][j-1];    // å½“å‰å…ƒç´ 

            prefixSum[i][j] = upperArea + leftArea - overlapArea + currentValue;

            console.log(`è®¡ç®— prefixSum[${i}][${j}]:`);
            console.log(`  = ${upperArea}(ä¸Š) + ${leftArea}(å·¦) - ${overlapArea}(é‡å ) + ${currentValue}(å½“å‰)`);
            console.log(`  = ${prefixSum[i][j]}`);
        }
    }

    console.log("\næœ€ç»ˆå‰ç¼€å’ŒçŸ©é˜µ:");
    prefixSum.forEach((row, i) => {
        console.log(`ç¬¬${i}è¡Œ: [${row.join(', ')}]`);
    });

    return prefixSum;
}

// è¯¦ç»†ç¤ºä¾‹æ¼”ç¤º
const matrix = [
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
];

console.log("=== äºŒç»´å‰ç¼€å’Œæ„å»ºæ¼”ç¤º ===");
const prefixSum2D = build2DPrefixSum(matrix);

// éªŒè¯å‡ ä¸ªä½ç½®çš„è®¡ç®—
console.log("\n=== éªŒè¯è®¡ç®—ç»“æœ ===");
console.log("prefixSum[1][1] = 1 (ä»…åŒ…å«matrix[0][0])");
console.log("prefixSum[1][2] = 3 (åŒ…å«matrix[0][0] + matrix[0][1])");
console.log("prefixSum[2][2] = 12 (åŒ…å«å·¦ä¸Šè§’2Ã—2çŸ©å½¢: 1+2+4+5)");
console.log("prefixSum[3][3] = 45 (æ•´ä¸ªçŸ©é˜µçš„å’Œ: 1+2+...+9)");
```

#### çŸ©å½¢åŒºåŸŸå’ŒæŸ¥è¯¢

```javascript
/**
 * æŸ¥è¯¢çŸ©å½¢åŒºåŸŸçš„å’Œ
 *
 * å®¹æ–¥åŸç†ï¼š
 * sum = prefixSum[row2+1][col2+1] - prefixSum[row1][col2+1]
 *     - prefixSum[row2+1][col1] + prefixSum[row1][col1]
 *
 * @param {number[][]} prefixSum - äºŒç»´å‰ç¼€å’ŒçŸ©é˜µ
 * @param {number} row1 - å·¦ä¸Šè§’è¡Œç´¢å¼•
 * @param {number} col1 - å·¦ä¸Šè§’åˆ—ç´¢å¼•
 * @param {number} row2 - å³ä¸‹è§’è¡Œç´¢å¼•
 * @param {number} col2 - å³ä¸‹è§’åˆ—ç´¢å¼•
 * @returns {number} çŸ©å½¢åŒºåŸŸå’Œ
 */
function rangeSum2D(prefixSum, row1, col1, row2, col2) {
    return prefixSum[row2 + 1][col2 + 1] - prefixSum[row1][col2 + 1]
         - prefixSum[row2 + 1][col1] + prefixSum[row1][col1];
}

// ç¤ºä¾‹ï¼šæŸ¥è¯¢ä»(0,0)åˆ°(1,1)çš„çŸ©å½¢åŒºåŸŸå’Œ
console.log(rangeSum2D(prefixSum2D, 0, 0, 1, 1)); // 1+2+4+5 = 12
```

## æ ¸å¿ƒç®—æ³•æ€æƒ³ ğŸ¯

### å­æ•°ç»„å’Œé—®é¢˜

#### å’Œä¸ºKçš„å­æ•°ç»„

```javascript
/**
 * ç»Ÿè®¡å’Œä¸ºkçš„å­æ•°ç»„ä¸ªæ•°
 *
 * æ ¸å¿ƒæ€æƒ³ï¼š
 * åˆ©ç”¨å‰ç¼€å’Œ + å“ˆå¸Œè¡¨ä¼˜åŒ–
 * å¦‚æœå­˜åœ¨prefixSum[j] - prefixSum[i] = k
 * é‚£ä¹ˆå­æ•°ç»„arr[i...j-1]çš„å’Œä¸ºk
 *
 * @param {number[]} nums - è¾“å…¥æ•°ç»„
 * @param {number} k - ç›®æ ‡å’Œ
 * @returns {number} æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„ä¸ªæ•°
 */
function subarraySum(nums, k) {
    const prefixSumCount = new Map();
    prefixSumCount.set(0, 1); // å‰ç¼€å’Œä¸º0çš„æƒ…å†µ

    let prefixSum = 0;
    let count = 0;

    for (const num of nums) {
        prefixSum += num;

        // æŸ¥æ‰¾prefixSum - kæ˜¯å¦å­˜åœ¨
        if (prefixSumCount.has(prefixSum - k)) {
            count += prefixSumCount.get(prefixSum - k);
        }

        // æ›´æ–°å½“å‰å‰ç¼€å’Œçš„è®¡æ•°
        prefixSumCount.set(prefixSum, (prefixSumCount.get(prefixSum) || 0) + 1);
    }

    return count;
}

// ç¤ºä¾‹
console.log(subarraySum([1, 1, 1], 2)); // 2ï¼Œå­æ•°ç»„[1,1]å‡ºç°2æ¬¡
console.log(subarraySum([1, 2, 3], 3)); // 2ï¼Œå­æ•°ç»„[3]å’Œ[1,2]
```

#### è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œï¼ˆKadaneç®—æ³•çš„å‰ç¼€å’Œç†è§£ï¼‰

```javascript
/**
 * è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ
 *
 * å‰ç¼€å’Œè§†è§’çš„ç†è§£ï¼š
 * åœ¨æ‰€æœ‰å¯èƒ½çš„prefixSum[j] - prefixSum[i]ä¸­æ‰¾æœ€å¤§å€¼
 * ç­‰ä»·äºæ‰¾æœ€å¤§çš„prefixSum[j] - æœ€å°çš„prefixSum[i]
 *
 * @param {number[]} nums - è¾“å…¥æ•°ç»„
 * @returns {number} æœ€å¤§å­æ•°ç»„å’Œ
 */
function maxSubArray(nums) {
    let maxSum = nums[0];
    let minPrefixSum = 0; // æœ€å°å‰ç¼€å’Œ
    let prefixSum = 0;

    for (const num of nums) {
        prefixSum += num;
        // å½“å‰å‰ç¼€å’Œå‡å»ä¹‹å‰çš„æœ€å°å‰ç¼€å’Œ
        maxSum = Math.max(maxSum, prefixSum - minPrefixSum);
        // æ›´æ–°æœ€å°å‰ç¼€å’Œ
        minPrefixSum = Math.min(minPrefixSum, prefixSum);
    }

    return maxSum;
}

// ç¤ºä¾‹
console.log(maxSubArray([-2, 1, -3, 4, -1, 2, 1, -5, 4])); // 6
```

### å·®åˆ†æ•°ç»„

#### åŒºé—´ä¿®æ”¹çš„ä¼˜åŒ–

```javascript
/**
 * å·®åˆ†æ•°ç»„å®ç°åŒºé—´ä¿®æ”¹
 *
 * æ ¸å¿ƒæ€æƒ³ï¼š
 * å·®åˆ†æ•°ç»„diff[i] = arr[i] - arr[i-1]
 * åŒºé—´[left, right]åŠ ä¸Švalï¼šdiff[left] += val, diff[right+1] -= val
 * æœ€åå‰ç¼€å’Œé‡æ„åŸæ•°ç»„
 *
 * @param {number[]} arr - åŸæ•°ç»„
 * @param {number[][]} updates - æ›´æ–°æ“ä½œ[[left, right, val], ...]
 * @returns {number[]} æ›´æ–°åçš„æ•°ç»„
 */
function applyRangeUpdates(arr, updates) {
    const n = arr.length;
    const diff = new Array(n + 1).fill(0);

    // æ„å»ºåˆå§‹å·®åˆ†æ•°ç»„
    for (let i = 0; i < n; i++) {
        diff[i] = arr[i] - (i > 0 ? arr[i-1] : 0);
    }

    // åº”ç”¨åŒºé—´æ›´æ–°
    for (const [left, right, val] of updates) {
        diff[left] += val;
        if (right + 1 < n) {
            diff[right + 1] -= val;
        }
    }

    // é‡æ„æ•°ç»„
    const result = new Array(n);
    result[0] = diff[0];
    for (let i = 1; i < n; i++) {
        result[i] = result[i-1] + diff[i];
    }

    return result;
}

// ç¤ºä¾‹
const originalArr = [1, 2, 3, 4, 5];
const updates = [[1, 3, 2], [2, 4, 3]]; // [1,3]åŒºé—´+2ï¼Œ[2,4]åŒºé—´+3
console.log(applyRangeUpdates(originalArr, updates)); // [1, 4, 8, 9, 8]
```

### å‰ç¼€å¼‚æˆ–

#### å­æ•°ç»„å¼‚æˆ–é—®é¢˜

```javascript
/**
 * å¼‚æˆ–å‰ç¼€å’Œåº”ç”¨
 *
 * æ ¸å¿ƒæ€§è´¨ï¼š
 * A âŠ• A = 0, A âŠ• 0 = A
 * prefixXor[j] âŠ• prefixXor[i] = arr[i+1] âŠ• ... âŠ• arr[j]
 *
 * @param {number[]} arr - è¾“å…¥æ•°ç»„
 * @param {number} target - ç›®æ ‡å¼‚æˆ–å€¼
 * @returns {number} å¼‚æˆ–å€¼ä¸ºtargetçš„å­æ•°ç»„ä¸ªæ•°
 */
function subarrayXOR(arr, target) {
    const prefixXorCount = new Map();
    prefixXorCount.set(0, 1);

    let prefixXor = 0;
    let count = 0;

    for (const num of arr) {
        prefixXor ^= num;

        // æŸ¥æ‰¾prefixXor ^ targetæ˜¯å¦å­˜åœ¨
        const needed = prefixXor ^ target;
        if (prefixXorCount.has(needed)) {
            count += prefixXorCount.get(needed);
        }

        prefixXorCount.set(prefixXor, (prefixXorCount.get(prefixXor) || 0) + 1);
    }

    return count;
}

// ç¤ºä¾‹
console.log(subarrayXOR([4, 2, 2, 6, 4], 6)); // 4ä¸ªå­æ•°ç»„
```

## ç®—æ³•æ€æƒ³æ€»ç»“ ğŸ¯

### å¤æ‚åº¦å¯¹æ¯”


| æ“ä½œç±»å‹     | æš´åŠ›è§£æ³• | å‰ç¼€å’Œä¼˜åŒ– | ç©ºé—´å¤æ‚åº¦ |
| ------------ | -------- | ---------- | ---------- |
| åŒºé—´å’ŒæŸ¥è¯¢   | O(n)     | O(1)       | O(n)       |
| å¤šæ¬¡åŒºé—´æŸ¥è¯¢ | O(mÃ—n)  | O(n+m)     | O(n)       |
| äºŒç»´åŒºåŸŸæŸ¥è¯¢ | O(mÃ—n)  | O(1)       | O(mÃ—n)    |
| åŒºé—´ä¿®æ”¹     | O(n)     | O(1)       | O(n)       |

### è®¾è®¡æ€æƒ³

**ç©ºé—´æ¢æ—¶é—´**ï¼šé€šè¿‡é¢„å¤„ç†å’Œé¢å¤–å­˜å‚¨ç©ºé—´ï¼Œå°†æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä»O(n)é™åˆ°O(1)

**å®¹æ–¥åŸç†**ï¼šäºŒç»´å‰ç¼€å’Œåˆ©ç”¨å®¹æ–¥åŸç†è®¡ç®—çŸ©å½¢åŒºåŸŸå’Œï¼Œé¿å…é‡å¤è®¡ç®—

**æ•°å­¦å˜æ¢**ï¼šå°†å¤æ‚çš„åŒºé—´é—®é¢˜è½¬åŒ–ä¸ºç®€å•çš„å‰ç¼€å’Œç›¸å‡é—®é¢˜

**å·®åˆ†æ€æƒ³**ï¼šå·®åˆ†æ•°ç»„æ˜¯å‰ç¼€å’Œçš„é€†è¿ç®—ï¼Œç”¨äºä¼˜åŒ–åŒºé—´ä¿®æ”¹æ“ä½œ

### é€‚ç”¨åœºæ™¯æ€»ç»“

- **é¢‘ç¹åŒºé—´æŸ¥è¯¢**ï¼šå¤šæ¬¡æŸ¥è¯¢æ•°ç»„åŒºé—´å’Œæ—¶ä½¿ç”¨å‰ç¼€å’Œ
- **å­æ•°ç»„é—®é¢˜**ï¼šç»“åˆå“ˆå¸Œè¡¨è§£å†³å’Œä¸ºKçš„å­æ•°ç»„ç­‰é—®é¢˜
- **çŸ©é˜µåŒºåŸŸæŸ¥è¯¢**ï¼šäºŒç»´å‰ç¼€å’Œå¤„ç†çŸ©å½¢åŒºåŸŸå’ŒæŸ¥è¯¢
- **åŒºé—´æ‰¹é‡ä¿®æ”¹**ï¼šå·®åˆ†æ•°ç»„ä¼˜åŒ–å¤šæ¬¡åŒºé—´ä¿®æ”¹æ“ä½œ
- **å¼‚æˆ–è¿ç®—**ï¼šå‰ç¼€å¼‚æˆ–è§£å†³å­æ•°ç»„å¼‚æˆ–é—®é¢˜
